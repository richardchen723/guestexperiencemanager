{% extends "base.html" %}

{% block title %}Dashboard - Hostaway Insights{% endblock %}

{% block content %}
<div class="dashboard-page">
    <!-- Header -->
    <div class="page-header">
        <h1>Dashboard</h1>
        <p class="dashboard-subtitle">Welcome back, {{ current_user.name or current_user.email }}</p>
    </div>
    
    <!-- Loading State -->
    <div id="dashboardLoading" class="dashboard-loading">
        <div class="spinner"></div>
        <span>Loading dashboard...</span>
    </div>
    
    <!-- Error State -->
    <div id="dashboardError" class="dashboard-error" style="display: none;">
        <p>Failed to load dashboard data. <button onclick="loadDashboard()" class="btn btn-secondary">Retry</button></p>
    </div>
    
    <!-- Content (hidden until loaded) -->
    <div id="dashboardContent" style="display: none;">
        <!-- Statistics Cards -->
        <div class="dashboard-stats-grid">
            <div class="stat-card stat-card-clickable" id="statCardMyTickets" onclick="navigateToMyTickets()">
                <div class="stat-icon">üìã</div>
                <div class="stat-value" id="statTotalAssigned">-</div>
                <div class="stat-label">My Tickets</div>
            </div>
            <div class="stat-card stat-card-clickable" id="statCardDueThisWeek" onclick="navigateToDueThisWeek()">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-value" id="statDueThisWeek">-</div>
                <div class="stat-label">Due This Week</div>
            </div>
            <div class="stat-card stat-card-warning stat-card-clickable" id="statCardOverdue" onclick="navigateToOverdue()">
                <div class="stat-icon">‚ö†Ô∏è</div>
                <div class="stat-value" id="statOverdue">-</div>
                <div class="stat-label">Overdue</div>
            </div>
            <div class="stat-card stat-card-danger stat-card-clickable" id="statCardHighPriority" onclick="navigateToHighPriority()">
                <div class="stat-icon">üî•</div>
                <div class="stat-value" id="statHighPriority">-</div>
                <div class="stat-label">High Priority</div>
            </div>
        </div>
        
        <!-- My Tickets Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Top Priority Tickets Assigned to Me</h2>
                <a href="/tickets?assigned_user_id={{ current_user.user_id }}" class="btn-link">View All</a>
            </div>
            <div id="myTicketsList" class="tickets-list dashboard-tickets-list">
                <!-- Tickets loaded via JavaScript -->
            </div>
            <div id="noTickets" class="empty-state" style="display: none;">
                <p>No tickets assigned to you.</p>
            </div>
        </div>
        
        <!-- Occupancy Chart Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Occupancy Rate (Last 6 Months)</h2>
            </div>
            <div class="chart-container">
                <canvas id="occupancyChart"></canvas>
            </div>
            <div id="noOccupancyData" class="empty-state" style="display: none;">
                <p>No occupancy data available.</p>
            </div>
        </div>
        
        <!-- Quick Actions (Desktop) -->
        <div class="dashboard-actions desktop-only">
            <a href="/tickets/create" class="btn btn-primary">Create New Ticket</a>
            <a href="/tickets?assigned_user_id={{ current_user.user_id }}" class="btn btn-secondary">View All My Tickets</a>
        </div>
    </div>
    
    <!-- Sticky Action Bar (Mobile) -->
    <div class="sticky-actions mobile-only">
        <a href="/tickets/create" class="btn btn-primary btn-full">Create New Ticket</a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // Set current user ID for dashboard navigation
    window.CURRENT_USER_ID = {{ current_user.user_id if current_user.user_id else 'null' }};
</script>
<script src="{{ url_for('static', filename='js/dashboard-page.js') }}"></script>
{% endblock %}



